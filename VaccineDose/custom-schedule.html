<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <link href="css/style.css" rel="stylesheet" />
    <link href="css/bootstrap-timepicker.min.css" rel="stylesheet" />
    <link rel="icon" href="img/favicon.ico">

</head>
<body>
    <div class="container">

        <!--menu will be insert in below div; code written in common.js-->
        <!--<div id="menu"></div>-->
        <nav class="navbar navbar-default">
            <div class="container-fluid">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="#">MyVaccs</a>
                </div><!--/.nav-collapse -->
                <div id="navbar" class="navbar-collapse collapse">
                    <ul class="nav navbar-nav navbar-right">
                        <li><a href="index.html">Home</a></li>
                        <li id="menu-doctor-signup"><a href="doctor-signup.html">Doctor Signup</a></li>
                        <li id="menu-vaccine"><a href="vaccine.html">Vaccine</a></li>
                        <li id="menu-doctor"><a href="doctor.html">Doctor</a></li>
                        <li id="menu-clinic"><a href="clinic.html">Clinic</a></li>
                        <li id="menu-child"><a href="child.html">Child</a></li>
                        <li id="menu-custom-schedule" class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Schedules <span class="caret"></span></a>
                            <ul class="dropdown-menu">
                                <li><a href="custom-schedule.html">Custom Schedule</a></li>
                                <li class="disabled"><a href="#">WHO Schedule</a></li>
                            </ul>
                        </li>
                        <li id="menu-logout"><a href="#" onclick="return logout()">Logout</a></li>
                        <li id="menu-login"><a href="login.html">Login</a></li>

                    </ul>
                </div><!--/.nav-collapse -->
            </div><!--/.container-fluid -->
        </nav>
        <div class="container">
            <h2>Create you custom schedule</h2>
            <div id="alert_message" class="alert alert-dismissible alert-warning">
                <button type="button" class="close" data-dismiss="alert">&nbsp;&times;&nbsp;</button>
                <strong>loading title!</strong>
                <p>loading message</p>
            </div>

            <form id="form1" action="" method="post" class="add-clinic-form" role="form" data-toggle="validator">

                <p class="btnLine">
                    <input type="hidden" value="1" name="total_forms" class="total-forms" />
                    <input type="button" class="btn btn-primary" id="btnAdd" onclick="return Add();" value="Create Schedule" />
                </p>
            </form>

        </div>


    </div><!-- /.container -->

    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/validator.min.js"></script>

    <script src="js/common.js"></script>
    <script>
        $(document).ready(function () {

            ShowAlert('Loading data', 'Please wait, fetching data from server', 'info');
            $.ajax({
                url: SERVER + "dose",
                type: "GET",
                contentType: "application/json;charset=utf-8",
                dataType: "json",
                success: function (result) {
                    if (!result.IsSuccess) {
                        ShowAlert('Error', result.Message, 'danger');
                    } else {
                        $.each(result.ResponseData, function (key, item) {
                            markup = '';
                            if (key == 0) {
                                markup = getClinicForm(1, item);
                                $('.btnLine').before(markup);
                                total_forms = 1;
                                $('.add-clinic-form .total-forms').val(total_forms);
                            } else {
                                form_id = $('.form-fields:last').attr('data-form-id');
                                form_id++;
                                markup = getClinicForm(form_id, item);
                                $('.form-fields:last').after(markup);
                                total_forms = $('.form-fields').length;
                                $('.add-clinic-form .total-forms').val(total_forms);
                            }
                        });
                        HideAlert();
                    }
                },
                error: function (errrmessage) {

                }
            });


        });
        function Add() {
            var total_forms = $('.add-clinic-form .total-forms').val();

            var DoctorID = DoctorId();
            var DoctorSchedule = [];

            var DoctorID = DoctorId();
            for (var i = 1; i <= total_forms; i++) {
                var doseID = $("#DoseID_" + i).val();
                var Gap = $("#GapInDays_" + i).val();

                DoctorSchedule.push({ DoseID: doseID, GapInDays: Gap, DoctorID: DoctorID })
            }

            $.ajax({
                url: SERVER + "doctorschedule",
                data: JSON.stringify(DoctorSchedule),
                type: "POST",
                contentType: "application/json;charset=utf-8",
                dataType: "json",
                success: function (result) {

                    if (!result.IsSuccess)
                        ShowAlert('Error', result.Message, 'danger');
                    else {
                        ShowAlert('Success', 'Custom schedule is saved.', 'success');
                        ScrollToTop();
                    }
                },
                error: function (errormessage) {
                    alert(errormessage.responseText);
                }
            });
        }
        function DoctorId() {
            var id = parseInt(getParameterByName("id")) || 0;
            if (id != 0)
                return id;
            else {
                var id = localStorage.getItem('DoctorID');
                if (id)
                    return id;
                else 0;
            }
        }


        function getClinicForm(form_id, dose) {
            markup = '<div class="form-group form-fields" data-form-id="' + form_id + '">';
            markup += '<div class="row">';
            markup += '<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">';
            markup += '<select id="GapInDays_' + form_id + '" name="GapPeriod_' + form_id + '" class="form-control" required>';
            markup += '<option value="">-- select time --</option>';
            markup += '<option value="0">At Birth</option>';
            markup += '<option value="42">6 Weeks</option>';
            markup += '<option value="49">7 Weeks</option>';
            markup += '<option value="56">8 Weeks</option>';
            markup += '<option value="63">9 Weeks</option>';
            markup += '<option value="70">10 Weeks</option>';
            markup += '<option value="77">11 Weeks</option>';
            markup += '<option value="84">12 Weeks</option>';
            markup += '<option value="91">13 Weeks</option>';
            markup += '<option value="98">14 Weeks</option>';
            markup += '<option value="105">15 Weeks</option>';
            markup += '<option value="112">16 Weeks</option>';
            markup += '<option value="119">17 Weeks</option>';
            markup += '<option value="126">18 Weeks</option>';
            markup += '<option value="133">19 Weeks</option>';
            markup += '<option value="140">20 Weeks</option>';
            markup += '<option value="147">21 Weeks</option>';
            markup += '<option value="154">22 Weeks</option>';
            markup += '<option value="161">23 Weeks</option>';
            markup += '<option value="168">24 Weeks</option>';
            markup += '<option value="212">7 Months</option>';
            markup += '<option value="243">8 Months</option>';
            markup += '<option value="273">9 Months</option>';
            markup += '<option value="304">10 Months</option>';
            markup += '<option value="334">11 Months</option>';
            markup += '<option value="365">12 Months</option>';
            markup += '<option value="395">13 Months</option>';
            markup += '<option value="426">14 Months</option>';
            markup += '<option value="456">15 Months</option>';
            markup += '<option value="486">16 Months</option>';
            markup += '<option value="547">1 Year 6 months</option>';
            markup += '<option value="608">1 Year 8 months</option>';
            markup += '<option value="730">2 Years</option>';
            markup += '<option value="760">2 Years 1 months</option>';
            markup += '<option value="1125">3 Years 1 months</option>';
            markup += '</select>';
            markup += '</div>';
            markup += '<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">';
            markup += '<input type="hidden" id="DoseID_' + form_id + '" name="DoseID_' + form_id + '" value="' + dose.ID + '">';
            markup += '<input type="text" class="form-control" placeholder="Dose Name" id="DoseName_' + form_id + '" name="DoseName_' + form_id + '" value="' + dose.Name + '" />';
            markup += '</div>';
            markup += '</row>';
            markup += '</div>';
            return markup;
        }
    </script>

</body>
</html>